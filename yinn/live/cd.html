<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ç®¡ç†æˆ‘çš„å»£å‘Š</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,"Noto Sans TC",Arial,sans-serif;background:#fafafa;color:#222;}
  .wrap{max-width:960px;margin:24px auto;padding:0 16px;}
  .top{display:flex;align-items:center;justify-content:space-between;margin:8px 0 16px;}
  .btn{padding:8px 12px;border-radius:10px;
    border:1px solid #ddd;
    background:#fff;
    cursor:pointer;
    font-weight:600;
    text-decoration:none;
    color:#c278ff;}
  .btn.danger{color:#fff;background:#e53935;border-color:#e53935;}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;}
  .card{background:#fff;border:1px solid #eee;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);}
  .thumb{width:100%;aspect-ratio:16/9;object-fit:cover;background:#f0f0f0;}
  .body{padding:10px}
  .title{font-weight:700;margin:4px 0 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .meta{font-size:12px;color:#666;line-height:1.4}
  .row{display:flex;gap:8px;align-items:center;margin-top:10px;}
  /* ========== å¤œé–“æ¨¡å¼è®Šæ•¸ ========== */
html[data-theme="dark"]{
  --text:#cfc3ff;
  --muted:#9a8fd1;
  --brand:#a48cff;
  --accent:#bf66ff;

  --card-bg:#161222;
  --card-border:#2b2440;
  --page-bg:#0f0b1a;

  --btn-bg:#1b1629;
  --btn-border:#2b2440;
  --btn-text:#cfc3ff;

  --shadow:0 10px 28px rgba(0,0,0,.45);
}

/* ========== å…¨å±€è‰²ç³»ï¼ˆå¤œé–“ï¼‰ ========== */
html[data-theme="dark"] body{ background:var(--page-bg); color:var(--text); }
html[data-theme="dark"] .meta,
html[data-theme="dark"] label{ color:var(--muted); }
html[data-theme="dark"] .card{ background:var(--card-bg); border-color:var(--card-border); color:var(--text); box-shadow:var(--shadow);}
html[data-theme="dark"] .btn{ background:var(--btn-bg); border:1px solid var(--btn-border); color:var(--btn-text); }
html[data-theme="dark"] .btn.danger{ background:#b91c1c; border-color:#b91c1c; color:#fff; }
html[data-theme="dark"] input[type="date"]{ background:var(--card-bg); color:var(--text); border:1px solid var(--card-border); }

/* ========== åœ“çƒæŒ‰éˆ• + ä¸‹æ‹‰é¸å–® ========== */
.menu-wrap{ position:relative; display:inline-flex; gap:8px; align-items:center; margin-left:8px; }

/* åœ“çƒæŒ‰éˆ• */
.menu-btn{
  width:34px; height:34px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; font-weight:700; line-height:1;
  background:var(--brand); color:#fff; border:none;
  cursor:pointer; transition:transform .2s ease, background .2s ease, box-shadow .2s ease;
  box-shadow:0 4px 12px rgba(108,78,247,.22);
}
.menu-btn:hover{ transform:scale(1.08); }
.menu-btn:active{ transform:scale(.95); }
html[data-theme="dark"] .menu-btn{
  background:var(--btn-bg);
  border:1px solid var(--btn-border);
  color:var(--btn-text);
  box-shadow:none;
}

/* ä¸‹æ‹‰ */
.dropdown{
  position:absolute; top:calc(100% + 8px); right:0;
  transform:translateY(-6px) scale(.98);
  opacity:0; visibility:hidden; pointer-events:none;
  min-width:200px; border-radius:14px; padding:8px; z-index:999;
  transition:opacity .16s ease, transform .18s cubic-bezier(.2,.8,.2,1);
  background:#fdeaff; color:#4a3a6a; border:1px solid #f5ccff;
  box-shadow:0 16px 32px rgba(0,0,0,.18);
}
.dropdown.show{ transform:translateY(0) scale(1); opacity:1; visibility:visible; pointer-events:auto; }
.dropdown .item{ width:100%; text-align:left; padding:10px 12px; border:0; background:transparent; color:inherit; border-radius:8px; cursor:pointer; transition:.12s; }
.dropdown .item:hover{ background:rgba(108,78,247,.10); transform:translateY(-1px); }
html[data-theme="dark"] .dropdown{ background:var(--card-bg); color:var(--text); border:1px solid var(--card-border); box-shadow:var(--shadow); }

/* å°è¢å¹•é‹ªæ»¿ */
@media (max-width:560px){
  .dropdown, .dropdown.show{ left:0 !important; right:auto !important; width:92vw; }
}
.t{
  text-decoration: none;
  color: rgb(158, 88, 255);
}
.top > div{
  display:flex;
  align-items:center;
  gap:6px;            /* â† æ§åˆ¶æŒ‰éˆ•ä¹‹é–“çš„è·é›¢ï¼ˆç¸®å°ä¸€é»ï¼‰ */
  margin-right:-80px;   /* â† é å³ç¸®å°å¤–è· */
}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
  <h2 style="margin:0">æˆ‘çš„æŠ•æ”¾å»£å‘Š</h2>
  <div>
    <a class="btn" href="shopping.html">â† å›Store</a>
    <a class="btn" href="shopping.html#adHero" title="é»æ“Šç™¼ä½ˆå»£å‘Š">ï¼‹</a>
    <div class="menu-wrap">
      <button id="menuBtn" class="menu-btn" aria-expanded="false" onclick="toggleMenu()">%</button>
      <div id="menuDrop" class="dropdown" role="menu">
        <button class="item" onclick="toggleTheme()" id="modeItem">åˆ‡æ›æ¨¡å¼ï¼šå¤œé–“</button>
        <button class="item"><a href="../index.html" class="t">å›Sunlit Groveä¸»é </a></button>
    <button class="item" onclick="location.href='Grove.Examination-Yuan.html'">åƒåŠ ç®¡ç†å“¡</button>
    <button class="item" onclick="location.href='Grove. Control-Yuan.html'">Control</button>
    <button class="item" onclick="location.href='Grove.Executive-Yuan.html'">Executive</button>
    <button class="item" onclick="location.href='Grove.Judicial-Yuan.html'">ç”³è¨´</button>
    <button class="item" onclick="location.href='Grove.Legislative-Yuan.html'">Legislative</button>
    <button class="item" onclick="location.href='vote.html'">æŠ•ç¥¨å°ˆå€</button>
    <button class="item" onclick="location.href='constitution.html'">ç¶²ç«™ç”³æ˜</button>
      </div>
    </div>
  </div>
</div>
  
  <!-- æ—¥æœŸç¯©é¸ï¼šåªé¸å¹´æœˆæ—¥ -->
<div class="row" style="gap:8px; align-items:center; margin:4px 0 10px;">
  <label for="fltDate" style="font-size:14px;color:#555;">ä¾æ—¥æœŸæœå°‹ï¼š</label>
  <input id="fltDate" type="date" class="input" style="padding:8px 10px;border:1px solid #ddd;border-radius:10px;">
  <button class="btn" id="btnSearchDate" onclick="searchByDate()">æœå°‹</button>
  <button class="btn" id="btnClearDate" onclick="clearDate()">æ¸…é™¤</button>
</div>
  <div id="tip" style="margin:8px 0; color:#666;"></div>
  <div id="list" class="list"></div>
</div>

<script>
/** LeanCloud è¨­å®šï¼ˆå’Œé¦–é ä¿æŒä¸€è‡´ï¼‰ */
const APP_ID  = "ZDqo2eQBcSChCfRgwix9jUeI-gzGzoHsz";
const APP_KEY = "U66ybZWAD99LrT9zJnQlW52H";
const API     = "https://zdqo2eqb.lc-cn-n1-shared.com/1.1";

/** å°å·¥å…· */
const $ = s => document.querySelector(s);
function escapeHTML(s){ return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[m])); }

/** æª¢æŸ¥ç™»å…¥ */
const user  = JSON.parse(localStorage.getItem('sg_user')||'null');
const token = localStorage.getItem('sg_token')||'';
if(!user || !token){
  $('#tip').innerHTML = 'è«‹å…ˆç™»å…¥å¾Œå†ç®¡ç†å»£å‘Šã€‚<a href="index.html" class="btn">å›é¦–é ç™»å…¥</a>';
} else {
  loadMyAds();
}

/** è®€å–æˆ‘çš„å»£å‘Šï¼ˆowner æŒ‡å‘æˆ‘ï¼‰ */
/** è®€å–æˆ‘çš„å»£å‘Šï¼ˆowner æŒ‡å‘æˆ‘ï¼‰+ å¯é¸æ—¥æœŸéæ¿¾ */
async function loadMyAds(dateStr){
  $('#tip').textContent = 'è¼‰å…¥ä¸­â€¦';

  // åŸºæœ¬æ¢ä»¶ï¼šowner = æˆ‘
  const where = {
    owner: { "__type":"Pointer", "className":"_User", "objectId": user.objectId }
  };

  // è‹¥æœ‰é¸æ—¥æœŸï¼Œçµ„æˆ 00:00:00 ~ 23:59:59.999 çš„å€é–“ï¼ˆæœ¬åœ°æ™‚å€ -> ISOï¼‰
  if (dateStr) {
    const { startISO, endISO } = toDayRange(dateStr);
    where.createdAt = {
      "$gte": { "__type":"Date", "iso": startISO },
      "$lt" : { "__type":"Date", "iso": endISO  }
    };
  }

  const url = `${API}/classes/Ad?where=${encodeURIComponent(JSON.stringify(where))}&order=-createdAt&limit=100`;

  try{
    const r = await fetch(url, {
      headers:{'X-LC-Id':APP_ID,'X-LC-Key':APP_KEY,'X-LC-Session':token}
    });
    const d = await r.json();
    if(!r.ok) throw new Error(d.error||'è¼‰å…¥å¤±æ•—');
    const list = d.results||[];
    renderList(list);
    const extra = dateStr ? `ï¼ˆ${dateStr}ï¼‰` : '';
    $('#tip').textContent = list.length ? `å…± ${list.length} å‰‡${extra}` : `æ²’æœ‰ç¬¦åˆçš„å»£å‘Š${extra ? extra : ''}ã€‚`;
  }catch(e){
    $('#tip').textContent = e.message || 'è¼‰å…¥å¤±æ•—';
  }
}

/** æŠŠ input[type=date] çš„ yyyy-mm-dd è½‰ç‚ºç•¶æ—¥èµ·è¨– ISOï¼ˆæœ¬åœ° -> ISOï¼‰ */
function toDayRange(dateStr){
  // dateStr å½¢å¦‚ "2025-03-08"
  const [y,m,d] = dateStr.split('-').map(Number);
  const start = new Date(y, (m-1), d, 0,0,0,0);           // ç•¶åœ° 00:00
  const end   = new Date(y, (m-1), d, 23,59,59,999);      // ç•¶åœ° 23:59:59.999
  return { startISO: start.toISOString(), endISO: end.toISOString() };
}

/** é»ã€Œæœå°‹ã€æŒ‰éˆ•ï¼šç”¨æ—¥æœŸå»è¼‰å…¥ */
function searchByDate(){
  const dateStr = (document.getElementById('fltDate').value || '').trim();
  if(!dateStr){
    alert('è«‹å…ˆé¸æ“‡æ—¥æœŸ');
    return;
  }
  loadMyAds(dateStr);
}

/** é»ã€Œæ¸…é™¤ã€æŒ‰éˆ•ï¼šæ¸…ç©ºæ—¥æœŸä¸¦è¼‰å…¥å…¨éƒ¨ */
function clearDate(){
  const inp = document.getElementById('fltDate');
  if (inp) inp.value = '';
  loadMyAds(); // ä¸å‚³ dateStr -> å–å…¨éƒ¨
}

/** ç¹ªè£½å¡ç‰‡ */
function renderList(list){
  const box = $('#list'); 
  box.innerHTML = '';
  list.forEach(ad=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img class="thumb" src="${ad.imageUrl || ''}" alt="">
      <div class="body">
        <div class="title" title="${escapeHTML(ad.title||'')}">
          ${escapeHTML(ad.title||'(æœªå¡«æ¨™é¡Œ)')}
        </div>
        <div class="meta">
          é€£çµï¼š${ad.linkUrl ? escapeHTML(ad.linkUrl) : 'ï¼ˆç„¡ï¼‰'}<br>
          å»ºç«‹ï¼š${new Date(ad.createdAt).toLocaleString()}<br>
          ${ad.startAt ? ('é–‹å§‹ï¼š'+new Date(ad.startAt.iso||ad.startAt).toLocaleString()+'<br>') : ''}
          ${ad.endAt   ? ('çµæŸï¼š'+new Date(ad.endAt.iso||ad.endAt).toLocaleString()) : ''}
        </div>
        <div class="row">
          <button class="btn danger" onclick="deleteAd('${ad.objectId}', this)">åˆªé™¤</button>
        </div>
      </div>
    `;
    box.appendChild(card);
  });
}

/** åˆªé™¤å»£å‘Šï¼ˆå¾Œç«¯å¾¹åº•ç§»é™¤ï¼‰ */
async function deleteAd(id, btn){
  if(!confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡å»£å‘Šå—ï¼Ÿåˆªé™¤å¾Œç„¡æ³•å¾©åŸã€‚')) return;
  btn.disabled = true; btn.textContent = 'åˆªé™¤ä¸­â€¦';
  try{
    const r = await fetch(`${API}/classes/Ad/${id}`,{
      method:'DELETE',
      headers:{
        'X-LC-Id':APP_ID,
        'X-LC-Key':APP_KEY,
        'X-LC-Session': localStorage.getItem('sg_token')||''
      }
    });
    if(!r.ok){
      const d = await r.json().catch(()=>({}));
      throw new Error(d.error || 'åˆªé™¤å¤±æ•—');
    }
    // å¾ç•«é¢ç§»é™¤
    const card = btn.closest('.card');
    if(card) card.remove();
  }catch(e){
    alert(e.message || 'åˆªé™¤å¤±æ•—');
    btn.disabled = false; btn.textContent = 'åˆªé™¤';
  }
}
</script>
<script src="im.js"></script>
<!--=================-->
<p style="text-align: center; font-size: 13px; color: #999; margin-top: 40px;">
  ğŸ¾ Â© 2024 yinnlimçš„å°å®‡å®™ï½œå…§å®¹èˆ‡è¨­è¨ˆçš†ç”±ç³–ç³–æœ¬äººç”¨æ„›è£½ä½œ ğŸ’<br>
  æœªç¶“æˆæ¬Šè«‹å‹¿éš¨æ„ä½¿ç”¨ã€ç›œè½‰å–” ğŸ™…â€â™€ï¸ è¬è¬ä½ çš„å°Šé‡èˆ‡æº«æŸ” ğŸ’Œ
</p>
</body>
</html>