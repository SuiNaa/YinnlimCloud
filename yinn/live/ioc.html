<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>IO æŸ¥è©¢</title>
<style>
  :root{ --brand:#6c4ef7; --muted:#777; --ok:#16a34a; --warn:#f59e0b; --bad:#e11d48; }
  *{box-sizing:border-box}
  body{ margin:0; font-family: system-ui, -apple-system, "Noto Sans TC", Arial, sans-serif; background:#f6f7fb; color:#222; }
  .wrap{ max-width:900px; margin:0 auto; padding:140px 14px 60px; }
  /* å›ºå®šå€åŸŸæ”¹æˆå½ˆæ€§å®¹å™¨ */
.header-bar {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 120;
  display: flex;
  flex-wrap: wrap;        /* å°è¢å¹•æœƒè‡ªå‹•æ›è¡Œ */
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 14px;
  background: #fff;
  border-bottom: 1px solid #eee;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}

/* è¿”å›éµ */
.back-home {
  flex: 0 0 auto;
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid #ddd;
  background: #fff;
  font-weight: 700;
  text-decoration: none;
  color: var(--brand);
  white-space: nowrap;
}

/* æœå°‹åˆ— */
.search-bar {
  flex: 1 1 auto;
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 200px;
}
.search-input {
  flex: 1;
  height: 40px;
  padding: 0 12px;
  border: 1px solid #ddd;
  border-radius: 999px;
  background: #fff;
  font-size: 15px;
}

/* æŒ‰éˆ• */
.btn {
  flex: 0 0 auto;
  padding: 8px 14px;
  border-radius: 12px;
  border: 1px solid #ddd;
  background: #fff;
  font-weight: 700;
  cursor: pointer;
}
.btn.primary {
  background: var(--brand);
  color: #fff;
  border-color: transparent;
}

/* æç¤ºæ–‡å­— */
.hint-under {
  position: static;     /* ä¸è¦ fixedï¼Œæ”¾ header ä¸‹æ–¹ */
  width: 100%;
  text-align: center;
  margin-top: 70px;     /* çµ¦ header é¨°ä½ç½® */
  color: var(--muted);
  font-size: 14px;
}

/* å°è¢å¹•èª¿æ•´ */
@media (max-width: 600px) {
  .header-bar {
    flex-direction: column;    /* å‚ç›´å †ç–Š */
    align-items: stretch;
  }
  .search-bar {
    width: 100%;
  }
  .btn {
    padding: 8px 12px;
    font-size: 14px;
  }
}
  .card{ background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.06); padding:18px; }
  .result{ margin-top:16px; }
  .urow{ display:flex; gap:14px; align-items:center; }
  .avatar{ width:64px; height:64px; border-radius:50%; object-fit:cover; background:#f3f3f3; border:1px solid #eee; }
  .title{ font-size:18px; font-weight:800; }
  .kv{ display:grid; grid-template-columns: 120px 1fr; gap:8px 14px; margin-top:12px; }
  .label{ color:#666; }
  .pill{ display:inline-flex; align-items:center; padding:4px 10px; border-radius:999px; font-weight:800; font-size:12px; }
  .ok{ background:#eaf7ee; color:#186a3a; }
  .warn{ background:#fff7e6; color:#8a5a00; }
  .bad{ background:#fee7ee; color:#8a1230; }
  .none{ background:#eef2ff; color:#3730a3; }
  .err{ color:var(--bad); margin-top:8px; }
  /* === ä¸»é¡Œè®Šæ•¸ï¼ˆå«ç™½å¤©æ·¡ç²‰é¸å–®ï¼‰ === */
:root{
  --brand:#6c4ef7; --muted:#777;
  --dropdown-bg:#fdeaff;        /* æ·¡ç²‰ */
  --dropdown-border:#f5ccff;
  --dropdown-text:#4a3a6a;
}

html[data-theme="dark"]{
  --text:#cfc3ff; --muted:#9a8fd1;
  --brand:#a48cff;
  --card-bg:#161222; --card-border:#2b2440; --page-bg:#0f0b1a;
  --btn-bg:#1b1629; --btn-border:#2b2440; --btn-text:#cfc3ff;
  --shadow:0 10px 28px rgba(0,0,0,.45);
}

/* === åœ“çƒæŒ‰éˆ• === */
.menu-wrap{ position:relative; display:inline-flex; gap:8px; align-items:center; }
.menu-btn{
  width:34px; height:34px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; font-weight:800; line-height:1;
  background:var(--brand); color:#fff; border:none; cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease;
  box-shadow:0 6px 14px rgba(108,78,247,.22);
}
.menu-btn:hover{ transform:scale(1.08); }
.menu-btn:active{ transform:scale(.95); }
html[data-theme="dark"] .menu-btn{
  background:var(--btn-bg); border:1px solid var(--btn-border); color:var(--btn-text); box-shadow:none;
}

/* === ä¸‹æ‹‰é¸å–®ï¼ˆç™½å¤©æ·¡ç²‰ï¼›å¤œé–“æš—è‰²ï¼›ç„¡çªèµ·ï¼‰ === */
.dropdown{
  position:absolute; top:calc(100% + 8px); left:0;
  transform:translateX(8px) translateY(-6px) scale(.98);
  opacity:0; visibility:hidden; pointer-events:none;
  min-width:220px; max-width:min(320px,80vw);
  background:var(--dropdown-bg); color:var(--dropdown-text);
  border:1px solid var(--dropdown-border);
  border-radius:14px; padding:8px; z-index:1200;
  box-shadow:0 16px 32px rgba(0,0,0,.18);
  transition:opacity .16s ease, transform .18s cubic-bezier(.2,.8,.2,1);
  right: -90px;              /* é å³é‚Šå°é½Š */
  left: auto;            /* ç¦ç”¨åŸæœ¬çš„ left */
  max-width: 90vw;       /* æœ€å¤šä½”è¢å¹• 90% å¯¬ */
  overflow-wrap: break-word;
}
.dropdown.show{ transform:translateX(8px) translateY(0) scale(1); opacity:1; visibility:visible; pointer-events:auto; }
.dropdown::after{ content:none; }             /* â† å»æ‰çªèµ· */
.dropdown .item{ width:100%; text-align:left; padding:10px 12px; border:0; background:transparent; color:inherit; border-radius:8px; cursor:pointer; transition:.12s; }
.dropdown .item:hover{ background:rgba(108,78,247,.10); transform:translateY(-1px); }
@media (max-width: 560px) {
  .dropdown {
    left: 0 !important;
    right: auto !important;
    width: 92vw;         /* å°è¢å¹•ç›´æ¥é‹ªæ»¿ */
  }
}
html[data-theme="dark"] .dropdown{
  background:var(--card-bg); color:var(--text); border:1px solid var(--card-border); box-shadow:var(--shadow);
}

/* === å¤œé–“æ•´é è¦†å¯« === */
html[data-theme="dark"] body{ background:var(--page-bg); color:var(--text); }
html[data-theme="dark"] .wrap{ color:var(--text); }
html[data-theme="dark"] .card{ background:var(--card-bg); border:1px solid var(--card-border); box-shadow:var(--shadow); }

/* å›ºå®šåœ¨ä¸Šé¢çš„å…©å€‹å€å¡Š */
html[data-theme="dark"] .back-home{
  background:var(--card-bg); color:var(--text);
  border:1px solid var(--card-border);
}
html[data-theme="dark"] .hint-under{ color:var(--muted); }

/* æœå°‹åˆ— */
html[data-theme="dark"] .search-input{
  background:transparent; color:var(--text);
  border:1px solid var(--card-border);
  box-shadow:none;
}
html[data-theme="dark"] .btn{
  background:var(--btn-bg); border:1px solid var(--btn-border); color:var(--btn-text);
}
html[data-theme="dark"] .btn.primary{
  background:var(--brand); color:#161222; border-color:transparent;
}

/* å°é ­åƒé‚Šæ¡†åœ¨æš—è‰²æ™‚ */
html[data-theme="dark"] .avatar{ background:#1e1930; border:1px solid var(--card-border); }

/* æ¨™ç±¤è† å›Šï¼ˆok/warn/bad/noneï¼‰åœ¨æš—è‰²ä¿æŒå¯è®€ */
html[data-theme="dark"] .ok{ background:#16331f; color:#a8ffd1; }
html[data-theme="dark"] .warn{ background:#3a2c0f; color:#ffd992; }
html[data-theme="dark"] .bad{ background:#3a0f1d; color:#ff9ab0; }
html[data-theme="dark"] .none{ background:#1e1f3a; color:#cfd3ff; }
</style>
<style>
  /*æ¸¸æ¨™*/
/* é€æ˜ 1x1 æ¸¸æ¨™ï¼ˆè³‡æ–™URIï¼‰ï¼Œæ¯”å–®ç´” none æ›´ä¸æœƒè¢«ç€è¦½å™¨è‡¨æ™‚è¦†è“‹ */
:root{
  --cursor-none: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEklEQVQImWNgYGBgYAAAAAQAARV7J8EAAAAASUVORK5CYII=') 0 0, none;
}

/* å¾¹åº•å¥—ç”¨åˆ°æ‰€æœ‰ç›’èˆ‡å½å…ƒç´  */
html, body, *, *::before, *::after{
  cursor: var(--cursor-none) !important;
}

/* ä»»ä½•åŸæœ¬æœƒæŠŠæ¸¸æ¨™æ”¹æˆ pointer / text çš„å…ƒç´ ï¼Œå¼·åˆ¶ç¹¼æ‰¿å°±ä¸æœƒè·³å›åŸç”Ÿæ¨£å¼ */
a, button, [role="button"], label, summary,
input, textarea, select, option, details, svg, canvas{
  cursor: inherit !important;
}

/* ä½ çš„è‡ªè¨‚æ¸¸æ¨™å¤–å±¤ï¼ˆä¸è®Šï¼‰ */
#cursor{
  position: fixed; left:0; top:0; width:0; height:0;
  pointer-events: none; will-change: transform; z-index: 9999;
}
/* å…§å±¤åœ–ç‰‡ï¼ˆä¸è®Šï¼‰ */
#cursor .cursor-img{
  width:32px; height:32px;
  background: url('../sea.png') center/contain no-repeat;
  transform: translate(-8px,-12px) scale(1);
  transition: transform .12s ease; 
  will-change: transform;
}
#cursor.down .cursor-img{ 
  transform: translate(-8px,-12px) scale(.9); 
}
/* é€æ˜é®ç½©ï¼šé è¨­ä¸æ“‹äº’å‹•ï¼Œä½†åœ¨æ²å‹•ç¬é–“çŸ­æš«æ¥æ‰‹ hit-test ä»¥ä¿è­‰ cursor:none ç”Ÿæ•ˆ */
#cursor-shield{
  position: fixed;
  inset: 0;
  cursor: var(--cursor-none) !important;  /* ä¸€å¾‹éš±è—ç³»çµ±æ¸¸æ¨™ */
  pointer-events: none;                   /* å¹³å¸¸ä¸æ“‹é»æ“Š/æ»‘å‹• */
  z-index: 9998;                          /* ä½æ–¼è‡ªè¨‚æ¸¸æ¨™ #cursor */
}

/* ã€Œæ²å‹•ä¸­ã€çŸ­æš«å•Ÿç”¨å‘½ä¸­ï¼ˆåªå½±éŸ¿æ¸¸æ¨™å‘½ä¸­ï¼Œä¸æœƒå½±éŸ¿æ»¾å‹•ï¼‰ */
#cursor-shield.cover{
  pointer-events: auto;                   /* è®“å®ƒæˆç‚ºå‘½ä¸­å…ƒç´ ï¼Œæ¸¸æ¨™å°±ä¸æœƒè¢«ä¸‹é¢åŸç”Ÿæ§ä»¶å¥ªå› */
}

</style>
</head>
<body>
  <div id="cursor-shield"></div>
<div id="cursor"><div class="cursor-img"></div></div>
<div class="header-bar">
  <a class="back-home" href="user.html">â† è¿”å›å€‹äººä¸»é </a>
  <div class="search-bar">
    <input id="ioInput" class="search-input" type="text" placeholder="è¼¸å…¥ IO è™Ÿç¢¼ï¼Œä¾‹å¦‚ï¼šIO202408240001">
    <button class="btn primary" onclick="searchByIO()">æŸ¥è©¢</button>
    <div class="menu-wrap">
      <button id="menuBtn" class="menu-btn" aria-expanded="false" onclick="toggleMenu()">%</button>
      <div id="menuDrop" class="dropdown" role="menu">
    <!-- ç¬¬ä¸€å€‹é¸é …ï¼šåˆ‡æ›æ¨¡å¼ -->
    <button class="item" onclick="toggleTheme()" id="modeItem">åˆ‡æ›æ¨¡å¼ï¼šå¤œé–“</button>
     <button class="item" onclick="location.href='../index.html'">ä¸»é </button>
    <button class="item" onclick="location.href='Grove.Examination-Yuan.html'">åƒåŠ ç®¡ç†å“¡</button>
    <button class="item" onclick="location.href='Grove. Control-Yuan.html'">Control</button>
    <button class="item" onclick="location.href='Grove.Executive-Yuan.html'">Executive</button>
    <button class="item" onclick="location.href='Grove.Judicial-Yuan.html'">ç”³è¨´</button>
    <button class="item" onclick="location.href='Grove.Legislative-Yuan.html'">Legislative</button>
    <button class="item" onclick="location.href='vote.html'">æŠ•ç¥¨å°ˆå€</button>
    <button class="item" onclick="location.href='constitution.html'">ç¶²ç«™ç”³æ˜</button>
        </div>
    </div>
  </div>
  </div>
  <div class="hint-under">
  å°æŠ€å·§ï¼šç¶²å€å¯ç”¨ <code>?io=ä½ çš„IOè™Ÿ</code> ç›´æ¥æ‰“é–‹æŸ¥è©¢
</div>

  <div class="wrap">
    <div class="card">
      <div id="result" class="result"></div>
      <div id="err" class="err"></div>
    </div>
  </div>

<script>
/* ====== LeanCloud å¸¸æ•¸ ====== */
const API     = "https://zdqo2eqb.lc-cn-n1-shared.com/1.1";
const APP_ID  = "ZDqo2eQBcSChCfRgwix9jUeI-gzGzoHsz";
const APP_KEY = "U66ybZWAD99LrT9zJnQlW52H";

/* ====== åŒ¯ç‡ï¼šIo$1 = 60 ====== */
const IO_RATE = 60;

/* ====== å°å·¥å…· ====== */
const q = (s)=>document.querySelector(s);
const fmtMoney = (n)=> (typeof n==='number' && isFinite(n)) ? n.toLocaleString(undefined,{maximumFractionDigits:2}) : 'â€”';
const toIo$ = (p)=> {
  const v = Number(p)/IO_RATE;
  return isFinite(v) ? v.toFixed(6) : 'â€”';
};
const statusToBadge = (st)=>{
  if(!st) return `<span class="pill none">æœªç™¼è²¨</span>`;
  const s=String(st).toLowerCase();
  if(['received','signed','delivered','completed','done','finish','finished'].includes(s)) return `<span class="pill ok">å·²ç°½æ”¶</span>`;
  if(['shipped','ship','shipping','sent','dispatched'].includes(s)) return `<span class="pill ok">å·²ç™¼è²¨</span>`;
  if(['rejected','reject'].includes(s)) return `<span class="pill bad">å·²é§å›</span>`;
  if(['appeal','after_sale','aftersale','service','refund'].includes(s)) return `<span class="pill warn">å”®å¾Œéšæ®µ</span>`;
  return `<span class="pill none">æœªç™¼è²¨</span>`;
};

/* å…§åµŒ SVG é è¨­é ­åƒï¼ˆé¿å…å¤–ç«™ SSL/è·¨åŸŸå•é¡Œï¼‰ */
const AVATAR_FALLBACK = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
  <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">
    <circle cx="48" cy="48" r="48" fill="#eef2ff"/>
    <circle cx="48" cy="36" r="16" fill="#c7d2fe"/>
    <rect x="20" y="58" width="56" height="22" rx="11" fill="#c7d2fe"/>
  </svg>`);

/* ====== è®€è¨‚å–® ====== */
async function fetchOrderByIO(io){
  const token = localStorage.getItem('sg_token') || '';
  const where = encodeURIComponent(JSON.stringify({ io }));
  // ä¸è³­æ¬„ä½åï¼Œå…ˆæ‹¿è¨‚å–®æœ¬é«”ï¼›product/variant ä»å˜—è©¦ include ä»¥é¡¯ç¤ºæ¨™é¡Œ/è¦æ ¼
  const url = `${API}/classes/Order?where=${where}&include=${encodeURIComponent('product,variant')}&limit=1`;
  const res = await fetch(url, { headers:{ 'X-LC-Id':APP_ID,'X-LC-Key':APP_KEY,'X-LC-Session':token }});
  const data = await res.json();
  if(!res.ok) throw new Error(data.error || 'æŸ¥è©¢å¤±æ•—');
  return data.results && data.results[0] || null;
}

/* å¾è¨‚å–®è£¡è‡ªå‹•æ‰¾ä»»ä½• _User æŒ‡æ¨™çš„ objectId */
function findAnyUserId(order){
  if(!order || typeof order!=='object') return null;
  for(const k of Object.keys(order)){
    const v = order[k];
    if(v && typeof v==='object' && v.__type==='Pointer' && v.className==='_User' && v.objectId){
      return v.objectId; // å‘½ä¸­ä¸€å€‹å°±å›å‚³
    }
  }
  return null;
}

/* å¦‚æœæœ‰å¿«ç…§æ¬„ä½å°±ç”¨å¿«ç…§ï¼ˆä¸éœ€è¦å†è«‹æ±‚ï¼‰ */
function readSnapshotUser(order){
  if(!order) return null;
  if(order.buyerNickname || order.buyerAvatarUrl || order.buyerGid){
    return {
      objectId: order.buyerGid || order.buyerId || '',
      nickname: order.buyerNickname || order.buyerName || '',
      avatarUrl: order.buyerAvatarUrl || ''
    };
  }
  return null;
}

/* ç›´æ¥ GET /users/:idï¼ˆä½ ç¾åœ¨çš„ _User CLP å…è¨± getï¼‰ */
async function fetchUserById(id){
  const token = localStorage.getItem('sg_token') || '';
  const res = await fetch(`${API}/users/${id}`, { headers:{ 'X-LC-Id':APP_ID,'X-LC-Key':APP_KEY,'X-LC-Session':token }});
  const data = await res.json();
  if(!res.ok) throw new Error(data.error || 'è®€å–ç”¨æˆ¶å¤±æ•—');
  return data;
}

/* æ±ºå®šé¡¯ç¤ºå“ªå€‹è²·å®¶è³‡è¨Šï¼šå¿«ç…§å„ªå…ˆ â†’ æŒ‡æ¨™æƒæ â†’ å¤±æ•—ç”¨é è¨­ */
async function resolveBuyer(order){
  // 1) å¿«ç…§
  const snap = readSnapshotUser(order);
  if(snap) return snap;

  // 2) æƒæä»»ä½• _User æŒ‡æ¨™
  const uid = findAnyUserId(order);
  if(uid){
    try{
      const u = await fetchUserById(uid);
      return {
        objectId: u.objectId || uid,
        nickname: u.nickname || u.username || u.email || '',
        avatarUrl: u.avatarUrl || (u.avatar && u.avatar.url) || ''
      };
    }catch(e){
      console.warn('[resolveBuyer] ç„¡æ³•è®€ _Userï¼š', e.message||e);
      return { objectId: uid, nickname: '', avatarUrl: '' };
    }
  }
  return { objectId:'â€”', nickname:'', avatarUrl:'' };
}

/* æ¸²æŸ“ */
function render(order, buyer){
  const box = q('#result'), err = q('#err'); err.textContent='';
  if(!order){ box.innerHTML = `<div class="muted">æŸ¥ç„¡æ­¤ IO è™Ÿç¢¼ï¼Œè«‹å†ç¢ºèªã€‚</div>`; return; }

  const avatar = buyer.avatarUrl || AVATAR_FALLBACK;
  const nickname = buyer.nickname || '(æœªå‘½å)';
  const gid = buyer.objectId || 'â€”';

  const product = order.product || {};
  const title = product.title || '(æœªå‘½åå•†å“)';
  const spec = order.variantName || order.specName || (order.variant && order.variant.name) || 'â€”';
  const price = Number(order.price != null ? order.price : (product.price != null ? product.price : 0));
  const io = order.io || '';
  const status = order.status || '';

  box.innerHTML = `
    <div class="urow">
      <img class="avatar" src="${avatar}" alt="">
      <div>
        <div class="title">${nickname}</div>
        <div class="muted">GIDï¼š${gid}</div>
      </div>
    </div>
    <div class="kv">
      <div class="label">IO è™Ÿç¢¼</div><div>${io}</div>
      <div class="label">å•†å“åç¨±</div><div>${title}</div>
      <div class="label">è¦æ ¼</div><div>${spec}</div>
      <div class="label">åƒ¹æ ¼</div>
      <div>CNÂ¥ ${fmtMoney(price)}</div>
      <div class="label">Io$ é‡‘é¡</div><div>Io$ ${toIo$(price)} <span class="muted"></span></div>
      <div class="label">è¨‚å–®ç‹€æ…‹</div><div>${statusToBadge(status)}</div>
    </div>
  `;
}

async function searchByIO(){
  const io = q('#ioInput').value.trim();
  const err = q('#err'); err.textContent=''; q('#result').innerHTML='';
  if(!io){ err.textContent='è«‹å…ˆè¼¸å…¥ IO è™Ÿç¢¼'; return; }
  try{
    const order = await fetchOrderByIO(io);
    console.log('[Order raw]', order);
    const buyer = order ? await resolveBuyer(order) : {objectId:'â€”',nickname:'',avatarUrl:''};
    render(order, buyer);
  }catch(e){ err.textContent = e.message || 'æŸ¥è©¢å¤±æ•—'; }
}

/* æ”¯æ´ ?io=xxx */
(function boot(){
  const u = new URL(location.href);
  const io = (u.searchParams.get('io')||'').trim();
  if(io){ q('#ioInput').value = io; searchByIO(); }
})();
</script>
<script src="im.js"></script>
<script src="lioc.js?v=0.1.1"></script>
<!--=================-->
<p style="text-align: center; font-size: 13px; color: #999; margin-top: 40px;">
  ğŸ¾ Â© 2024 yinnlimçš„å°å®‡å®™ï½œå…§å®¹èˆ‡è¨­è¨ˆçš†ç”±ç³–ç³–æœ¬äººç”¨æ„›è£½ä½œ ğŸ’<br>
  æœªç¶“æˆæ¬Šè«‹å‹¿éš¨æ„ä½¿ç”¨ã€ç›œè½‰å–” ğŸ™…â€â™€ï¸ è¬è¬ä½ çš„å°Šé‡èˆ‡æº«æŸ” ğŸ’Œ
</p>
</body>
</html>