<!DOCTYPE html>
<html lang="zh-hant">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>å¯æ„›åœ–ç‰‡ç‰†ï½œYinnLim</title>
    
    <!-- å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <style>
    /* å…¨å±€å¯æ„›æ¼¸å±¤èƒŒæ™¯ */
    html, body {
      height: 100%;
    }

    body {
      background: linear-gradient(135deg, #ffe6f7 0%, #ffd9ec 30%, #e9d7ff 65%, #d6f0ff 100%);
      background-attachment: fixed;
      margin: 0;
      font-family: "BiauKai", "Kaiti TC", "STKaiti", "KaiTi", serif;
    }

    /* ğŸŒ¸ æ¼¢å ¡é¸å–®æ¨£å¼ */
    .menu-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 30px;
      height: 24px;
      cursor: pointer;
      z-index: 3000;
      background: transparent;
      border: none;
    }

    .menu-toggle span {
      display: block;
      height: 3px;
      margin: 5px 0;
      background-color: #ff66a5;
      transition: all 0.3s ease;
    }

    .menu-toggle.active span:nth-child(1) {
      transform: translateY(8px) rotate(45deg);
    }
    .menu-toggle.active span:nth-child(2) {
      opacity: 0;
    }
    .menu-toggle.active span:nth-child(3) {
      transform: translateY(-8px) rotate(-45deg);
    }

    .side-menu {
      position: fixed;
      top: 0;
      right: -250px;
      width: 250px;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      transition: right 0.4s ease;
      z-index: 2000;
    }

    .side-menu.open {
      right: 0;
    }

    .side-menu ul {
      list-style: none;
      padding: 60px 20px;
      margin: 0;
    }

    .side-menu li {
      margin: 20px 0;
    }

    .side-menu a {
      text-decoration: none;
      font-weight: bold;
      font-size: 18px;
      position: relative;
      display: inline-block;
      color: transparent;
      background: linear-gradient(90deg, #ff66a5, #fcb045);
      -webkit-background-clip: text;
      background-clip: text;
      transition: all 0.35s ease;
      font-weight: 500;
    }

    .side-menu a.login-btn,
    .side-menu a.hub-btn {
      color: #ff4d88 !important;
      background: none !important;
      -webkit-background-clip: unset !important;
      background-clip: unset !important;
    }

    .side-menu a.hub-btn {
      color: #e60073 !important;
    }

    .side-menu a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #ff66a5, #9b5de5, #00bbf9);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.35s ease;
    }

    .side-menu a:hover {
      letter-spacing: 1px;
      font-weight: 600;
    }

    .side-menu a:hover::after {
      transform: scaleX(1);
      transform-origin: left;
    }

    /* æ¨™é¡Œæ¨£å¼ */
    h1 {
      color: #f2eaf5;
      text-shadow: 2px 2px 5px rgba(176, 60, 226, 0.6);
      text-align: center;
      margin-top: 60px;
    }

    /* åœ–ç‰‡ç‰†ç¶²æ ¼æ¨£å¼ */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .card .cap {
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card .dl {
      background: linear-gradient(135deg, #ff8bd1, #ff69b4);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
      transition: transform 0.2s ease;
    }

    .card .dl:hover {
      transform: scale(1.05);
    }

    /* ç”¨æˆ¶å€åŸŸæ¨£å¼ */
    #userArea {
      position: fixed;
      top: 10px;
      left: 10px;
      font-weight: bold;
      color: #663399;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
    }

    .edit-btn, .logout-btn {
      border: none;
      background: none;
      font-size: 16px;
      cursor: pointer;
      padding: 4px 8px;
      color: #663399;
      transition: transform 0.2s ease;
    }

    .edit-btn:hover, .logout-btn:hover {
      transform: scale(1.2);
    }

    .lim-town-label {
      display: inline-flex;
      flex-direction: column;
      line-height: 1;
      margin-right: 4px;
      align-items: center;
      font-weight: bold;
      font-size: 12px;
      vertical-align: middle;
    }

    .lim-town-label .lim {
      font-size: 14px;
    }

    .lim-town-label .town {
      font-size: 10px;
      color: #888;
    }

    /* Lightbox æ¨£å¼ */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .lightbox.show {
      display: flex;
    }

    .lb-inner {
      max-width: 90vw;
      max-height: 80vh;
      position: relative;
    }

    .lb-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 10px;
    }

    .lb-actions {
      position: absolute;
      bottom: -60px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    .btn {
      background: #ff69b4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    /* é è…³æ¨£å¼ */
    footer {
      text-align: center;
      font-size: 13px;
      color: #999;
      margin: 40px 0 20px;
      padding: 0 20px;
    }
    </style>
</head>
<body>
    <!-- ç”¨æˆ¶å€åŸŸ -->
    <div id="userArea">
        <span id="userNickname" title="YinnğŸªå¸³è™Ÿ">æš±ç¨±åŠ è¼‰ä¸­...</span>
        <button class="edit-btn" onclick="showEditNicknameOptions()" title="ä¿®æ”¹æš±ç¨±">âŒ˜</button>
        <span id="cnNickname" title="Limå¸³æˆ¶">è¼‰å…¥ä¸­...</span>
        <button class="logout-btn" onclick="showLogoutOptions()" title="ç™»å‡º">ğŸƒç™»å‡º</button>
        <button class="logout-btn" onclick="redirectBasedOnLocation()" title="ç™»å…¥">ğŸ“ç™»å…¥</button>
    </div>

    <!-- ä¸»æ¨™é¡Œ -->
    <h1>å¯æ„›åœ–ç‰‡ç‰† ğŸ€</h1>

    <!-- åœ–ç‰‡ç‰†å®¹å™¨ -->
    <div id="grid" class="gallery"></div>

    <!-- ğŸŒ¸ æ¼¢å ¡é¸å–® -->
    <div class="menu-toggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <nav class="side-menu" id="sideMenu">
        <ul>
            <li><a href="/index.html">é¦–é Home page</a></li>
            <li>
                <a href="javascript:void(0);" onclick="showTownLoginModal()" class="login-btn">
                    <span class="lim-town-label">
                        <span class="lim">Yinn</span>
                        <span class="town">Lim</span>
                    </span>ğŸ“ ç™»å…¥ï¼è¨»å†Š
                </a>
            </li>
            <li><a href="/Diverse/misseng.html">
                <span class="lim-town-label">
                    <span class="lim">Yinn</span>
                    <span class="town">Town</span>
                </span>
                æ›¦èŠ±æ—<sup>NEW</sup>
            </a></li>
            <li><a href="/Help.yinnlim/help.html" class="hub-btn">Grove Hub<sup>ğŸ’–</sup></a></li>
            <li><a href="/live/shopping.html">Grove Store</a></li>
            <li><a href="/live/constitution.html">ç¶²ç«™ç”³æ˜</a></li>
            <li><a href="About thisn site.html">è²¬ä»»ç”³æ˜</a></li>
            <li><a href="Emoticon pack.html">å¯æ„›è¡¨æƒ…</a></li>
        </ul>
    </nav>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" aria-hidden="true">
        <div class="lb-inner">
            <img id="lbImg" class="lb-img" alt="">
            <div class="lb-actions">
                <a id="lbDownload" class="btn" download>ä¸‹è¼‰</a>
                <button id="lbClose" class="btn" style="background: #666;">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- é è…³ -->
    <footer>
        ğŸ¾ Â© 2024 yinnlimçš„å°å®‡å®™ï½œå…§å®¹èˆ‡è¨­è¨ˆçš†ç”±ç³–ç³–æœ¬äººç”¨æ„›è£½ä½œ ğŸ’<br>
        æœªç¶“æˆæ¬Šè«‹å‹¿éš¨æ„ä½¿ç”¨ã€ç›œè½‰å–” ğŸ™…â€â™€ï¸ è¬è¬ä½ çš„å°Šé‡èˆ‡æº«æŸ” ğŸ’Œ
    </footer>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <!-- LeanCloud -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>

    <script>
    // Firebase é…ç½®
    const firebaseConfig = {
        apiKey: "AIzaSyBkLJKrOdTgk4uf58jpciJIHm9hEYQUFCw",
        authDomain: "yinnlim-mgsg-wall.firebaseapp.com",
        projectId: "yinnlim-mgsg-wall",
        storageBucket: "yinnlim-mgsg-wall.firebasestorage.app",
        messagingSenderId: "811614776183",
        appId: "1:811614776183:web:d0b11607a54b5a4d8a0f72"
    };
    firebase.initializeApp(firebaseConfig);

    // LeanCloud é…ç½®
    AV.init({
        appId: "jxPF13ZiTBmbFt75fXRnYs42-gzGzoHsz",
        appKey: "ydXYcG0fGtWLgWetR0szCygQ",
        serverURL: "https://jxpf13zi.lc-cn-n1-shared.com"
    });

    // æ¼¢å ¡é¸å–®åŠŸèƒ½
    function toggleMenu() {
        document.querySelector('.menu-toggle').classList.toggle('active');
        document.getElementById('sideMenu').classList.toggle('open');
    }

    // ç”¨æˆ¶ç‹€æ…‹ç®¡ç†
    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            document.getElementById("userNickname").textContent = user.displayName || "æœªè¨­å®šæš±ç¨±";
        } else {
            document.getElementById("userNickname").textContent = "æœªç™»å…¥";
        }
    });

    // LeanCloud ç”¨æˆ¶ç‹€æ…‹
    const currentUser = AV.User.current();
    if (currentUser) {
        const nickname = currentUser.get("nickname") || "æœªè¨­å®šæš±ç¨±";
        document.getElementById("cnNickname").innerHTML = `<span style="font-size: 13px;"><sup>Lim</sup>â‡¢</span>${nickname}`;
    } else {
        document.getElementById("cnNickname").innerHTML = '<span style="font-size:13px;"><sup>Lim</sup>â‡¥æœªç™»å…¥</span>';
    }

    // åœ–ç‰‡ç‰†æ•¸æ“š - å¾ Cloudflare Workers åŠ è¼‰
    const WORKER_URL = 'https://yinncloud.suinaa852.workers.dev/';

    async function loadGallery() {
        try {
            const response = await fetch(WORKER_URL + '?v=' + Date.now(), { 
                cache: 'no-store' 
            });
            
            if (!response.ok) throw new Error('è¼‰å…¥å¤±æ•—');
            
            const { files } = await response.json();
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            // æŒ‰æ–‡ä»¶åæ’åº
            files.sort((a, b) => a.url.localeCompare(b.url));

            files.forEach(({ url }) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${url}" alt="å¯æ„›åœ–ç‰‡" loading="lazy">
                    <div class="cap">
                        <a class="dl" href="${url}" download>ä¸‹è¼‰</a>
                    </div>
                `;
                
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.dl')) return;
                    openLightbox(url, 'å¯æ„›åœ–ç‰‡');
                });
                
                grid.appendChild(card);
            });

        } catch (error) {
            document.getElementById('grid').innerHTML = `
                <div style="text-align: center; color: #ff6b6b; padding: 40px;">
                    ğŸ¥º è¼‰å…¥åœ–ç‰‡å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦
                </div>
            `;
        }
    }

    // Lightbox åŠŸèƒ½
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbDl = document.getElementById('lbDownload');
    const lbClose = document.getElementById('lbClose');

    function openLightbox(url, alt) {
        lbImg.src = url;
        lbImg.alt = alt || '';
        lbDl.href = url;
        lbDl.download = alt || '';
        lb.classList.add('show');
        lb.setAttribute('aria-hidden', 'false');
    }

    function closeLightbox() {
        lb.classList.remove('show');
        lb.setAttribute('aria-hidden', 'true');
    }

    lb.addEventListener('click', (e) => {
        if (e.target === lb) closeLightbox();
    });

    lbClose.addEventListener('click', closeLightbox);
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
    });

    // å…¶ä»–åŠŸèƒ½å‡½æ•¸
    function showTownLoginModal() {
        document.getElementById("townLoginModal").style.display = "flex";
    }

    function showLogoutOptions() {
        document.getElementById("logoutOptions").style.display = "block";
    }

    function redirectBasedOnLocation() {
        fetch("https://ipapi.co/json/")
            .then(res => res.json())
            .then(data => {
                const country = data.country_code;
                if (country === "CN") {
                    window.location.href = "/Lim/limlongin/login.html";
                } else {
                    window.location.href = "/Diverse/login.html";
                }
            })
            .catch(() => {
                window.location.href = "/Diverse/login.html";
            });
    }

    // åˆå§‹åŒ–åŠ è¼‰
    loadGallery();
    </script>
</body>
</html>