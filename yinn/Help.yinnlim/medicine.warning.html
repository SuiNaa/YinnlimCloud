<!doctype html>
<html lang="zh-Hant" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è—¥ç‰©æŸ¥è©¢ï½œæ›¦èŠ±æ—</title>
<link rel="icon" href="favicon.ico" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&display=swap" rel="stylesheet">
<style>
/* ========= ä¸»é¡Œè®Šæ•¸ ========= */
:root{
  --bg:#f9f6ff; --text:#2c2a33; --muted:#64748b; --card:#fff; --border:#e6e3ef;
  --accent:#b78ad3; --link:#3a87ff; --chip:#f2ecff; --shadow:0 8px 24px rgba(0,0,0,.08);
  --maxw: 1060px;

  /* æ¸¸æ¨™ï¼šé€æ˜ 1x1ï¼ˆé¿å…è¢«ç€è¦½å™¨è‡¨æ™‚è¦†è“‹ï¼‰ */
  --cursor-none: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEklEQVQImWNgYGBgYAAAAAQAARV7J8EAAAAASUVORK5CYII=') 0 0, none;
}
html[data-theme="dark"]{
  --bg:#0f0d14; --text:#eceaf2; --muted:#a9a6b3; --card:#151220; --border:#2b2637;
  --accent:#a790d8; --link:#9cc0ff; --chip:#241e33; --shadow:0 8px 24px rgba(0,0,0,.55);
}

/* ========= åŸºç¤ ========= */
*{ box-sizing:border-box }
html, body, *, *::before, *::after{ cursor: var(--cursor-none) !important; } /* éš±è—åŸç”Ÿæ¸¸æ¨™ */

body{
  margin:0; color:var(--text);
  background:
    radial-gradient(1200px 700px at 70% -10%, rgba(217,234,255,.35) 0%, transparent 60%),
    linear-gradient(160deg, #ffe0ff 0%, #efe6ff 100%), var(--bg);
  min-height:100dvh;
  font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", Arial, "Microsoft JhengHei";
}
html[data-theme="dark"] body{ background:linear-gradient(160deg,#0f0d14 0%,#151220 100%) }
.wrap{max-width:var(--maxw); margin:0 auto; padding:18px 16px}

/* ========= é ‚éƒ¨å·¥å…·åˆ— ========= */
.topbar{display:flex; align-items:center; gap:10px; margin-bottom:10px}
.logo{
  width:26px; height:26px; border-radius:50%;
  background:url('img/grove.png') center/cover no-repeat;
  flex:0 0 auto;
}
.title{ font-weight:800; letter-spacing:.02em }
.spacer{ flex:1 }
.toolbar{ display:flex; align-items:center; gap:8px }
.btn-ghost{
  background:transparent; border:1px solid var(--border); color:var(--text);
  padding:6px 10px; border-radius:10px;
}
.btn-ghost:hover{ filter:brightness(.96) }

/* ========= æœå°‹ï¼‹ç¯©é¸ï¼ˆå…©è¡Œå›ºå®šé †åºã€éŸ¿æ‡‰å¼ï¼‰ ========= */
.controls{
  display:flex; flex-direction:column; gap:12px;
  margin:12px 0 14px; align-items:center;
}
/* ç¬¬ä¸€è¡Œï¼šç½®ä¸­é•·æ¢æœå°‹ï¼ˆè—¥ä¸¸ï¼‰ */
.controls-top{ width:100%; display:flex; justify-content:center; }
.controls .input{
  -webkit-appearance:none; appearance:none;
  height:44px; line-height:44px;
  padding:0 16px; border:1px solid var(--border);
  border-radius:999px; background:var(--card); color:var(--text);
  width:100%; max-width:640px; min-width:240px; box-sizing:border-box;
}
input[type="search"]::-webkit-search-cancel-button{ -webkit-appearance:none; }

/* ç¬¬äºŒè¡Œï¼šå…©å€‹ç¯©é¸ + æ•¸é‡åŒæ’ç½®ä¸­ï¼Œå¿…è¦æ™‚æ›è¡Œ */
.controls-row{
  width:100%; display:flex; align-items:center; justify-content:center;
  gap:12px; flex-wrap:wrap;
}
.controls-row .filters{ display:flex; align-items:center; gap:12px; flex:0 0 auto; }
.controls-row .chip{
  flex:0 0 auto; align-self:center; background:var(--chip);
  border:1px solid var(--border); padding:6px 10px; border-radius:999px; color:var(--text);
}

/* ========= åŸç”Ÿ select çš„ã€ŒçŸ©å½¢ç´°é»ã€åœ“è§’ã€æ¨£å¼ï¼ˆè‹¥æœ‰ç”¨ï¼‰ ========= */
.select.rect-chip{
  display:inline-block; background:var(--card); color:var(--text);
  border:1.5px dotted var(--accent); border-radius:12px;
  padding:10px 36px 10px 12px; min-height:40px; height:auto;
  width:auto; max-width:none; white-space:nowrap;
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background-clip:padding-box; box-shadow:none;
  background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='1.6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position: right 12px center; background-size: 12px 8px;
}
.select.rect-chip:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(183,138,211,.22);
}
html[data-theme="dark"] .select.rect-chip{
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23c9c6d4' stroke-width='1.6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
}

/* ========= å‡ä¸‹æ‹‰ï¼ˆæŒ‰éˆ•ï¼‹é¸å–®ï¼‰ ========= */
.dropdown{ position: relative; display:inline-block; }

/* ä¸‹æ‹‰æŒ‰éˆ•ï¼šæ¥·é«”ã€è¼ƒç´°å­—ã€å¾®æµ®é›• */
.dropdown-btn{
  font-family:'Noto Serif TC','BiauKai','DFKai-SB','KaiTi','Kaiti SC',serif;
  font-weight:500; letter-spacing:.01em;
  color:var(--text); background:var(--card);
  border:1.5px dotted var(--accent); border-radius:14px;
  min-height:40px; height:40px; line-height:40px;
  padding:0 38px 0 14px; white-space:nowrap; position:relative;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .2s ease;
  box-shadow:0 1px 0 rgba(255,255,255,.6) inset, 0 6px 14px rgba(0,0,0,.08);
  display:inline-flex; align-items:center; justify-content:center;
}
.dropdown-btn:hover{
  transform: translateY(-1px);
  border-color: color-mix(in oklab, var(--accent) 70%, transparent);
  box-shadow:0 1px 0 rgba(255,255,255,.75) inset, 0 10px 24px rgba(0,0,0,.18);
}
.dropdown-btn:active{ transform: translateY(0); box-shadow:0 1px 0 rgba(255,255,255,.55) inset, 0 4px 12px rgba(0,0,0,.14); }
.dropdown-btn:focus-visible{
  outline:none; box-shadow:0 0 0 3px rgba(183,138,211,.22), 0 8px 22px rgba(0,0,0,.14);
}
.dropdown-btn::after{
  content:""; position:absolute; right:12px; top:50%; width:12px; height:8px; transform:translateY(-50%);
  background:no-repeat center/contain url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='1.6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
}
.dropdown-btn[aria-expanded="true"]::after{ transform:translateY(-50%) rotate(180deg); }
html[data-theme="dark"] .dropdown-btn{
  background:linear-gradient(180deg, rgba(28,23,39,.88), rgba(28,23,39,.72)), var(--card);
  box-shadow:0 1px 0 rgba(255,255,255,.06) inset, 0 8px 18px rgba(0,0,0,.45);
}
html[data-theme="dark"] .dropdown-btn::after{
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23cfc9dd' stroke-width='1.6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
}

/* ä¸‹æ‹‰é¸å–®ï¼šå‹•ç•« + iOS ç»ç’ƒæ„Ÿ */
.dropdown-menu{
  position:absolute; top:calc(100% + 8px); left:0; min-width:180px;
  margin:0; padding:6px; list-style:none; z-index:2000;
  display:block; opacity:0; transform: translateY(6px) scale(.98);
  pointer-events:none; transition: opacity .14s ease, transform .14s ease;

  /* ç»ç’ƒæ„Ÿ */
  background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.58));
  -webkit-backdrop-filter: saturate(180%) blur(18px);
  backdrop-filter: saturate(180%) blur(18px);
  border: 1px solid rgba(255,255,255,.28);
  border-radius: 12px;
  box-shadow: 0 8px 26px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.35);
}
.dropdown.open .dropdown-menu{
  opacity:1; transform: translateY(0) scale(1); pointer-events:auto;
}
html[data-theme="dark"] .dropdown-menu{
  background: linear-gradient(180deg, rgba(28,23,39,.56), rgba(28,23,39,.42));
  border: 1px solid rgba(167,144,216,.28);
  box-shadow: 0 10px 30px rgba(0,0,0,.48), inset 0 1px 0 rgba(255,255,255,.06);
}

/* é¸å–®é …ï¼šæ¥·é«”ã€è¼ƒç´°å­—ã€ç·Šæ¹Šè¡Œè· */
.dropdown-menu li{
  font-family: 'Noto Serif TC','BiauKai','DFKai-SB','KaiTi','Kaiti SC',serif;
  font-weight: 500; font-size: .95rem; letter-spacing: .01em; line-height: 1.15;
  padding: 6px 10px; min-height: 34px; border-radius: 10px; white-space: nowrap;
  transition: background .12s ease, transform .04s ease;
}
.dropdown-menu li + li{ margin-top: 2px; }
.dropdown-menu li:hover{ background: color-mix(in oklab, var(--chip) 70%, transparent); }
.dropdown-menu li:active{ transform: translateY(1px); }

/* ========= å¡ç‰‡åˆ—è¡¨ ========= */
.list{ display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:12px }
.card{
  display:block; text-decoration:none; background:var(--card);
  border:1px solid var(--border); border-radius:14px;
  box-shadow:var(--shadow); padding:14px; color:var(--text);
}
.card .title{ font-weight:700; font-size:1.05rem; display:flex; align-items:center; gap:8px; flex-wrap:wrap }
.badge{ font-size:.78rem; padding:2px 8px; border:1px solid var(--border); border-radius:999px; background:var(--chip) }
.badge.rx{ border-color:#eab30855 }
.badge.otc{ border-color:#22c55e55 }
.meta{ display:flex; gap:6px; flex-wrap:wrap; margin:6px 0 8px }
.pill{ font-size:.8rem; padding:3px 8px; border:1px solid var(--border); border-radius:999px; background:var(--chip) }
.kv{ font-size:.92rem }
details{ margin-top:8px }
summary{ color:var(--link) }

/* ========= è©³æƒ…é  ========= */
body.is-detail .controls{ display:none }
.detail{
  background:var(--card); border:1px solid var(--border); border-radius:14px;
  box-shadow:var(--shadow); padding:16px;
}
.detail-head{ display:flex; align-items:center; gap:8px; margin-bottom:8px }
.detail h1{ margin:6px 0 10px; font-size:1.35rem }
.detail .meta{ margin-bottom:10px }
.detail-grid{ display:grid; grid-template-columns: 1fr; gap:12px }
.detail-grid > div{ border-top:1px dashed var(--border); padding-top:10px }
.detail-grid > div:first-child{ border-top:none; padding-top:0 }
.k{ color:var(--muted); font-weight:600; margin-bottom:4px }

/* ========= å›é ‚ ========= */
#goTop{
  position:fixed; right:16px; bottom:calc(16px + env(safe-area-inset-bottom)); z-index:60;
  display:none; width:44px; height:44px; border-radius:50%;
  border:1px solid var(--border); background:var(--card); color:var(--text);
  box-shadow:var(--shadow); font-size:20px; line-height:44px; text-align:center; cursor:pointer;
}
#goTop.show{ display:inline-flex; align-items:center; justify-content:center }
html[data-theme="dark"] #goTop{ background:#1b1626; border-color:#312a40 }

/* ========= è‡ªè¨‚æ¸¸æ¨™å¤–å±¤ & é€æ˜é®ç½© ========= */
#cursor{ position: fixed; left:0; top:0; width:0; height:0; pointer-events: none; will-change: transform; z-index: 9999; }
#cursor .cursor-img{
  width:32px; height:32px; background: url('../lio.png') center/contain no-repeat;
  transform: translate(-8px,-12px) rotate(0) scale(1);
  transition: transform .12s ease; will-change: transform;
}
#cursor.down .cursor-img{ transform: translate(-8px,-12px) rotate(-60deg) scale(.9); }
#cursor-shield{
  position: fixed; inset: 0; cursor: var(--cursor-none) !important; pointer-events: none; z-index: 9998;
}
#cursor-shield.cover{ pointer-events: auto; }

/* ========= å°å°ºå¯¸å„ªåŒ– ========= */
@media (max-width:520px){
  .title{ display:none }
  .controls .input{ max-width:100%; }
}
@media (max-width:360px){
  .controls .input{ min-width:220px; }
  .dropdown-menu li{ font-size:.93rem; padding:6px 10px; min-height:32px; }
}
</style>
</head>
<body>
  <div id="cursor-shield"></div>
<div id="cursor"><div class="cursor-img"></div></div>
<!-- =========|æ¸¸æ¨™|========= -->
  <div class="wrap">
    <!-- é ‚éƒ¨åˆ— -->
    <div class="topbar">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">è—¥ç‰©æŸ¥è©¢</div>
      <div class="spacer"></div>
      <div class="toolbar">
        <button class="btn-ghost" id="toggleTheme">ğŸŒ“ ä¸»é¡Œ</button>
        <button class="btn-ghost" id="goHome">ğŸ ğŸ¾è¿”å›</button>
      </div>
    </div>

   <!-- æœå°‹ï¼‹ç¯©é¸ï¼ˆå…©è¡Œï¼‰ -->
<div class="controls">
  <!-- ç¬¬ä¸€è¡Œï¼šç½®ä¸­é•·æ¢æœå°‹ -->
  <div class="controls-top">
    <input id="q" class="input" type="search"
      placeholder="æœå°‹è—¥åï¼åˆ¥åï¼æ©Ÿè½‰ï¼åŠ‘å‹â€¦" />
  </div>

  <!-- ç¬¬äºŒè¡Œï¼šå…©å€‹ç¯©é¸ + é …ç›®æ•¸ï¼ˆåŒä¸€æ’ï¼Œæœƒè‡ªé©æ‡‰ï¼‰ -->
  <div class="controls-row">
    <div class="filters">
      <!-- åˆ†é¡ -->
      <div class="dropdown" id="clsWrap">
        <button id="clsBtn" class="dropdown-btn" aria-haspopup="listbox" aria-expanded="false">
          å…¨éƒ¨åˆ†é¡
        </button>
        <ul id="clsMenu" class="dropdown-menu" role="listbox">
          <li role="option" data-val="">å…¨éƒ¨åˆ†é¡</li>
          <li role="option" data-val="HRT-æ¿€ç´ ">HRTï¼æ¿€ç´ ï¼ˆå«é»ƒé«”é…®ï¼‰</li>
          <li role="option" data-val="HRT-æŠ—é›„">HRTï¼æŠ—é›„</li>
          <li role="option" data-val="HRT-é˜»æ–·åŠ‘">HRTï¼é˜»æ–·åŠ‘</li>
          <li role="option" data-val="ç²¾éº»é¡">ç²¾éº»é¡</li>
        </ul>
      </div>

      <!-- RX/OTC -->
      <div class="dropdown" id="rxWrap">
        <button id="rxBtn" class="dropdown-btn" aria-haspopup="listbox" aria-expanded="false">
          å…¨éƒ¨è—¥å“
        </button>
        <ul id="rxMenu" class="dropdown-menu" role="listbox">
          <li role="option" data-val="">å…¨éƒ¨è—¥å“</li>
          <li role="option" data-val="RX">RXï¼ˆè™•æ–¹ï¼‰</li>
          <li role="option" data-val="OTC">OTCï¼ˆæˆè—¥ï¼‰</li>
        </ul>
      </div>
    </div>

    <span id="count" class="chip">0 é …</span>
  </div>
</div>

    <!-- åˆ—è¡¨ / è©³æƒ…å®¹å™¨ -->
    <div id="list" class="list" role="list"></div>
  </div>

  <button id="goTop" aria-label="å›åˆ°æœ€ä¸Šé¢">â†‘</button>
<script src="/Help.yinnlim/medicine.js?v=1.0.0"></script>
<script>
/* ============= å¿«æ·æŸ¥ DOM ============= */
/* ========= å¿«æ· DOM ========= */
const $ = (s, r=document) => r.querySelector(s);
const list  = $('#list');
const q     = $('#q');
const count = $('#count');

/* ========= ä¸‹æ‹‰å€¼ï¼ˆå–ä»£åŸç”Ÿ selectï¼‰========= */
let clsValue = "";   // åˆ†é¡
let rxValue  = "";   // RX/OTC

/* ========= å‡ä¸‹æ‹‰åˆå§‹åŒ–ï¼ˆæ–¹æ³• Bï¼‰========= */
document.addEventListener('pointerdown', (e)=>{
  const b = e.target.closest('.dropdown-btn');
  if (!b) return;
  const rect = b.getBoundingClientRect();
  b.style.setProperty('--rx', (e.clientX - rect.left) + 'px');
  b.style.setProperty('--ry', (e.clientY - rect.top)  + 'px');
}, {passive:true});

function initDropdown(btnId, menuId, onChange){
  const btn  = document.getElementById(btnId);
  const menu = document.getElementById(menuId);
  const wrap = btn.closest('.dropdown');

  // é–‹é—œ
  btn.addEventListener('click', (e)=>{
    e.stopPropagation();
    const willOpen = !wrap.classList.contains('open');
    document.querySelectorAll('.dropdown').forEach(d=> d.classList.remove('open'));
    wrap.classList.toggle('open', willOpen);
    btn.setAttribute('aria-expanded', String(willOpen));
  });

  // é¸å–
  menu.addEventListener('click', (e)=>{
    const li = e.target.closest('li[role="option"]');
    if (!li) return;
    const val  = li.getAttribute('data-val') || "";
    const text = li.textContent.trim();
    btn.textContent = text;                 // åªæ”¾æ–‡å­—ï¼Œç®­é ­ç”± ::after ç•«
    wrap.classList.remove('open');
    btn.setAttribute('aria-expanded','false');
    onChange(val);
  });
}

// é»å¤–é—œé–‰ / Esc é—œé–‰
document.addEventListener('click', ()=>{
  document.querySelectorAll('.dropdown').forEach(d=> d.classList.remove('open'));
  document.querySelectorAll('.dropdown-btn').forEach(b=> b.setAttribute('aria-expanded','false'));
});
document.addEventListener('keydown', (e)=>{
  if (e.key === 'Escape'){
    document.querySelectorAll('.dropdown').forEach(d=> d.classList.remove('open'));
    document.querySelectorAll('.dropdown-btn').forEach(b=> b.setAttribute('aria-expanded','false'));
  }
});

// ç¶å®šå…©å€‹å‡ä¸‹æ‹‰
initDropdown('clsBtn', 'clsMenu', (val)=>{
  clsValue = val;
  clearListState();
  if (location.hash) location.hash = '';
  applyFilter();
});
initDropdown('rxBtn', 'rxMenu', (val)=>{
  rxValue = val;
  clearListState();
  if (location.hash) location.hash = '';
  applyFilter();
});

/* ========= åˆ—è¡¨ç‹€æ…‹ï¼ˆä½ç½® & ç¯©é¸ï¼‰========= */
function saveListState(){
  sessionStorage.setItem('listScrollY', String(window.scrollY));
  sessionStorage.setItem('listQuery', q.value || '');
  sessionStorage.setItem('listCls', clsValue || '');
  sessionStorage.setItem('listRx',  rxValue  || '');
}
function clearListState(){
  sessionStorage.removeItem('listScrollY');
  sessionStorage.removeItem('listQuery');
  sessionStorage.removeItem('listCls');
  sessionStorage.removeItem('listRx');
}
function restoreListState(){
  const savedQ   = sessionStorage.getItem('listQuery');
  const savedCls = sessionStorage.getItem('listCls');
  const savedRx  = sessionStorage.getItem('listRx');

  if (savedQ !== null) q.value = savedQ;
  if (savedCls !== null) { clsValue = savedCls;  $('#clsBtn').textContent = savedCls ? savedCls : 'å…¨éƒ¨åˆ†é¡'; }
  if (savedRx !== null)  { rxValue  = savedRx;   $('#rxBtn').textContent  = savedRx  ? (savedRx==='RX'?'RXï¼ˆè™•æ–¹ï¼‰':'OTCï¼ˆæˆè—¥ï¼‰') : 'å…¨éƒ¨è—¥å“'; }

  applyFilter();

  const y = Number(sessionStorage.getItem('listScrollY') || '0');
  if (y > 0){
    requestAnimationFrame(()=> window.scrollTo({ top:y, behavior:'auto' }));
  }
}

/* ========= æ¸²æŸ“ï¼šåˆ—è¡¨ ========= */
function renderList(rows){
  list.className = 'list';
  list.innerHTML = '';
  rows.forEach(d=>{
    const a = document.createElement('a');
    a.className = 'card';
    a.href = `#/drug/${encodeURIComponent(d.id)}`;
    a.setAttribute('role','listitem');
    const classBadges = Array.isArray(d.class)
      ? d.class.map(x => `<span class="badge">${x}</span>`).join('')
      : `<span class="badge">${d.class}</span>`;
    a.innerHTML = `
      <div class="title">
        ğŸ’Š ${d.name}
        ${classBadges}
        <span class="badge ${d.rx==='RX'?'rx':'otc'}">${d.rx}</span>
      </div>
      <div class="meta">
        ${(d.aliases||[]).map(x=>`<span class="pill">${x}</span>`).join('')}
        ${d.forms ? `<span class="pill">${d.forms}</span>`:''}
      </div>
      <div class="kv"><strong>å¸¸è¦‹è™•æ–¹ç¯„åœï¼ˆåƒè€ƒï¼‰</strong>ï¼š${d.typicalDose||'â€”'}</div>
      <details>
        <summary>æŸ¥çœ‹ç°¡è¿°</summary>
        <div class="row"><span class="k">ä½œç”¨æ©Ÿè½‰</span><div>${d.actions||'â€”'}</div></div>
        <div class="row"><span class="k">ç›£æ¸¬æŒ‡æ¨™</span><div>${d.monitoring||'â€”'}</div></div>
      </details>
    `;
    a.addEventListener('click', saveListState);
    list.appendChild(a);
  });
  count.textContent = `${rows.length} é …`;
}

/* ========= æ¸²æŸ“ï¼šè©³æƒ…ï¼ˆåŸæ¨£ä¿ç•™ï¼‰========= */
function getDrugById(id){ return DRUGS.find(d=>d.id===id); }
function renderDetail(id){
  const d = getDrugById(id);
  document.body.classList.toggle('is-detail', true);
  list.className = '';
  const buildClassBadges = (cls) => Array.isArray(cls)
    ? cls.map(x => `<span class="badge">${x}</span>`).join('')
    : (cls ? `<span class="badge">${cls}</span>` : '');

  const buildImages = (imgs) => {
    if (!Array.isArray(imgs) || !imgs.length) return '';
    return `
      <div class="row">
        <div class="k">ç›¸é—œåœ–ç‰‡</div>
        <div class="gallery">
          ${imgs.map(src => `
            <a href="${src}" target="_blank" rel="noopener">
              <img src="${src}" alt="" style="max-width:100%;height:auto;border-radius:10px;display:block;margin:8px 0">
            </a>
          `).join('')}
          <div class="k" style="color:var(--muted)">æç¤ºï¼šé»åœ–å¯åœ¨æ–°åˆ†é é–‹å•ŸåŸåœ–ã€‚</div>
        </div>
      </div>`;
  };

  if (!d){
    list.innerHTML = `
      <article class="detail">
        <div class="detail-head"><button class="btn-ghost" onclick="history.back()">â† è¿”å›</button></div>
        <h1>æ‰¾ä¸åˆ°è—¥ç‰©</h1><p>é€™å€‹é€£çµçš„è—¥ç‰©ä¸å­˜åœ¨æˆ–å·²ç§»é™¤ã€‚</p>
      </article>`;
    count.textContent = '0 é …';
    return;
  }

  const classBadges = buildClassBadges(d.class);
  list.innerHTML = `
    <article class="detail">
      <div class="detail-head">
        <button class="btn-ghost" onclick="history.back()">â† è¿”å›</button>
        <div class="spacer"></div>
        <button class="btn-ghost" id="copyLink">ğŸ”— è¤‡è£½é€£çµ</button>
      </div>
      <h1>ğŸ’Š ${d.name}</h1>
      <div class="meta">
        ${classBadges}
        <span class="badge ${d.rx==='RX'?'rx':'otc'}">${d.rx}</span>
        ${(d.aliases||[]).map(x=>`<span class="pill">${x}</span>`).join('')}
        ${d.forms ? `<span class="pill">${d.forms}</span>`:''}
      </div>
      <section class="detail-grid">
        <div><div class="k">å¸¸è¦‹è™•æ–¹ç¯„åœï¼ˆåƒè€ƒï¼‰</div><div>${d.typicalDose||'â€”'}</div></div>
        <div><div class="k">ä½œç”¨æ©Ÿè½‰</div><div>${d.actions||'â€”'}</div></div>
        <div><div class="k">å¸¸è¦‹é©æ‡‰ç—‡</div><div>${d.indications||'â€”'}</div></div>
        <div><div class="k">ç›£æ¸¬æŒ‡æ¨™</div><div>${d.monitoring||'â€”'}</div></div>
        <div><div class="k">æ³¨æ„äº‹é …</div><div>${d.cautions||'â€”'}</div></div>
        <div><div class="k">äº¤äº’ä½œç”¨</div><div>${d.interactions||'â€”'}</div></div>
        <div><div class="k">å¸¸è¦‹å‰¯ä½œç”¨</div><div>${d.sideEffects|| 'â€”'}</div></div>
        <div><div class="k">ç”Ÿé«”å¯ç”¨ç‡ï¼ˆBioavailabilityï¼‰</div><div>${d.bioavailability || 'â€”'}</div></div>
        <div><div class="k">ä»£è¬èˆ‡é…µç´ ï¼ˆMetabolism / Enzymesï¼‰</div><div>${d.metabolism || 'â€”'}</div></div>
        <div><div class="k">é…µç´ æŠ‘åˆ¶ï¼èª˜å°ï¼ˆEnzyme inhibition / inductionï¼‰</div><div>${d.enzymeInhibition || d.enzymeEffects || 'â€”'}</div></div>
        <div><div class="k">æ¶ˆé™¤åŠè¡°æœŸï¼ˆtÂ½ï¼‰</div><div>${d.halfLife || 'â€”'}</div></div>
        <div><div class="k">åƒè€ƒè³‡æ–™</div>
          <div>${(d.refs||[]).map(r=>`<a href="${r.url}" target="_blank" rel="noopener">${r.name}</a>`).join('ã€')||'â€”'}</div>
        </div>
        ${ buildImages(d.images) }
      </section>
    </article>`;
  count.textContent = '1 é …';

  const btn = $('#copyLink');
  if (btn) btn.onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(location.href);
      btn.textContent = 'âœ… å·²è¤‡è£½';
      setTimeout(()=>btn.textContent='ğŸ”— è¤‡è£½é€£çµ',1200);
    }catch{}
  };
}

/* ========= æœå°‹/ç¯©é¸ ========= */
function normalize(s=''){
  if (!s) return '';
  s = s.normalize('NFKC').toLowerCase().trim();
  const map = {'é«”':'ä½“','è—¥':'è¯','åŠ‘':'å‰‚','é‹…':'é”Œ','é‹':'é“','éˆ£':'é’™','é‚':'é•','é»ƒ':'é»„','é¹½':'ç›','é¡':'ç±»'};
  s = s.split('').map(ch => map[ch] || ch).join('');
  return s;
}
function hasClass(drug, wanted){
  if (!wanted) return true;
  if (Array.isArray(drug.class)) return drug.class.map(x=>normalize(x)).includes(normalize(wanted));
  return normalize(drug.class) === normalize(wanted);
}
function applyFilter(){
  const kw   = normalize(q.value);
  const cVal = clsValue.trim();
  const rVal = rxValue.trim();

  const rows = DRUGS.filter(d=>{
    if (!hasClass(d, cVal)) return false;
    if (rVal && normalize(d.rx) !== normalize(rVal)) return false;
    if (!kw) return true;

    const classText = Array.isArray(d.class) ? d.class.join(' ') : d.class;
    const hay = normalize([
      d.name,(d.aliases||[]).join(' '),classText,d.rx,d.forms,
      d.actions, d.indications, d.monitoring, d.cautions, d.interactions,
      d.sideEffects, d.metabolism, d.enzymeInhibition || d.enzymeEffects, d.halfLife
    ].join(' '));
    return hay.includes(kw);
  });

  renderList(rows);
}

/* ========= è·¯ç”± ========= */
function router(){
  const m = location.hash.match(/^#\/drug\/(.+)$/);
  if (m){ renderDetail(decodeURIComponent(m[1])); }
  else{
    document.body.classList.toggle('is-detail', false);
    restoreListState();
  }
}
window.addEventListener('hashchange', router);

/* ========= å•Ÿå‹• ========= */
window.addEventListener('load', ()=>{
  router();
  if (!location.hash){ applyFilter(); }
});

/* ========= äº‹ä»¶ ========= */
q.addEventListener('input', ()=>{
  clearListState();
  if (location.hash) location.hash = '';
  applyFilter();
});

//========
/* === è®“ select ä¾ã€Œæœ€å¯¬çš„é¸é …ã€è‡ªå‹•æ’å¯¬ï¼ˆå«ç®­é ­ç·©è¡ï¼‰ === */
function autosizeSelect(sel){
  const meter = document.createElement('span');
  meter.style.position = 'absolute';
  meter.style.visibility = 'hidden';
  meter.style.whiteSpace = 'nowrap';
  meter.style.font = getComputedStyle(sel).font;
  document.body.appendChild(meter);

  // é‡æœ€å¯¬çš„ optionï¼Œè€Œä¸æ˜¯åªé‡ç•¶å‰é¸ä¸­çš„
  let maxW = 0;
  for (const opt of sel.options){
    meter.textContent = opt.text || '';
    const w = meter.getBoundingClientRect().width;
    if (w > maxW) maxW = w;
  }

  const padExtra = 64;  // å³å´ç®­é ­ + å…§è·ï¼šæŠ“å¤§ä¸€é»ï¼ŒiPad/Safari æ¯”è¼ƒä¸æœƒåˆ‡åˆ°å­—
  sel.style.width = Math.ceil(maxW + padExtra) + 'px';

  meter.remove();
}
function bindAutosizeForSelects(){
  document.querySelectorAll('select.rect-chip').forEach(sel=>{
    autosizeSelect(sel);
    sel.addEventListener('change', ()=> autosizeSelect(sel));
  });
  // è¦–çª—ç¸®æ”¾æ™‚é‡ç®—
  window.addEventListener('resize', ()=>{
    document.querySelectorAll('select.rect-chip').forEach(autosizeSelect);
  });
}
// å•Ÿå‹•é»ï¼šä½ åŸæœ¬çš„ window.load å¾Œé¢æ¥é€™è¡Œ
window.addEventListener('load', bindAutosizeForSelects);
</script>
<script>//æ¸¸æ¨™
const cursor = document.getElementById('cursor');
let lastX = 0, lastY = 0, ticking = false;

function onPointerMove(e){
  lastX = e.clientX; lastY = e.clientY;
  if (!ticking){
    requestAnimationFrame(()=>{
      cursor.style.transform = `translate3d(${lastX}px, ${lastY}px, 0)`;
      ticking = false;
    });
    ticking = true;
  }
}
function onScroll(){
  cursor.style.transform = `translate3d(${lastX}px, ${lastY}px, 0)`;
}
function onDown(){ cursor.classList.add('down'); }
function onUp(){   cursor.classList.remove('down'); }
function forceHideNative(){
  document.documentElement.style.setProperty('cursor','var(--cursor-none)','important');
  document.body.style.setProperty('cursor','var(--cursor-none)','important');
}
window.addEventListener('focus', forceHideNative);
document.addEventListener('visibilitychange', ()=> { if (!document.hidden) forceHideNative(); });
document.addEventListener('mouseenter', forceHideNative);
document.addEventListener('pointermove', onPointerMove, { passive:true });
document.addEventListener('pointerdown', onDown);
document.addEventListener('pointerup',   onUp);
document.addEventListener('scroll',      onScroll, { passive:true });
document.addEventListener('wheel',       onScroll, { passive:true });

// --- é˜²æ­¢æ»¾è¼ª/æ²å‹•æ™‚å†’å‡ºåŸç”Ÿæ¸¸æ¨™ï¼šçŸ­æš«é–‹å•Ÿ shield å‘½ä¸­ ---
const shield = document.getElementById('cursor-shield');
let shieldTimer = null;

// å•Ÿç”¨é®ç½©ä¸€å°æ®µæ™‚é–“
function coverShield(ms = 180){
  if (!shield) return;
  shield.classList.add('cover');
  clearTimeout(shieldTimer);
  shieldTimer = setTimeout(()=> shield.classList.remove('cover'), ms);
}

// åœ¨æœƒå‡ºç¾é–ƒçˆçš„æ™‚æ©Ÿå•Ÿç”¨ï¼ˆwheel/scroll/gestureï¼‰
document.addEventListener('wheel',  () => coverShield(0), {passive:true});
document.addEventListener('scroll', () => coverShield(0), {passive:true});

// ä½¿ç”¨è€…ä¸€æ—¦æŒ‰ä¸‹æˆ–é€²å…¥é é¢ï¼Œå°±é—œæ‰é®ç½©é¿å…æ“‹äº’å‹•
document.addEventListener('pointerdown', () => shield.classList.remove('cover'), {passive:true});
document.addEventListener('mouseenter',  () => shield.classList.remove('cover'), {passive:true});

// å†ä¿éšªï¼šè¦–çª—å›ç„¦æˆ–å¯è¦‹æ™‚ï¼Œé‡æ–°è“‹ä¸€æ¬¡ noneï¼ˆä½ å·²ç¶“æœ‰ forceHideNative ä¹ŸOKï¼‰
window.addEventListener('focus', () => coverShield(120));
document.addEventListener('visibilitychange', () => { if (!document.hidden) coverShield(120); });
</script>
<script>
(function(){
  const root = document.documentElement;
  const themeBtn = document.getElementById('toggleTheme');
  const homeBtn  = document.getElementById('goHome');

  // ä¸»é¡Œåˆ‡æ›ï¼ˆä¿ç•™åŸè¡Œç‚ºï¼‰
  try{
    const saved = localStorage.getItem('theme');
    if (saved === 'dark' || saved === 'light') {
      root.setAttribute('data-theme', saved);
    }
  }catch{}

  if (themeBtn){
    themeBtn.addEventListener('click', ()=>{
      const cur = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', cur);
      try{ localStorage.setItem('theme', cur); }catch{}
    });
  }

  // âœ… è¿”å›ï¼šä¸€å¾‹å›åˆ° help.html
  if (homeBtn){
    homeBtn.addEventListener('click', ()=>{
      location.href = '/Help.yinnlim/help.html';
    });
  }

  // ä¿éšªï¼šé¿å…æ¸¸æ¨™é®ç½©æ“‹åˆ°é»æ“Š
  const shield = document.getElementById('cursor-shield');
  const unblock = () => shield && shield.classList.remove('cover');
  ['pointerdown','click','mouseenter','touchstart'].forEach(evt=>{
    document.addEventListener(evt, unblock, {passive:true});
  });
})();
</script>
<!--=================-->
<p style="text-align: center; font-size: 13px; color: #999; margin-top: 40px;">
  ğŸ¾ Â© 2024 yinnlimçš„å°å®‡å®™ï½œå…§å®¹èˆ‡è¨­è¨ˆçš†ç”±ç³–ç³–æœ¬äººç”¨æ„›è£½ä½œ ğŸ’<br>
  æœªç¶“æˆæ¬Šè«‹å‹¿éš¨æ„ä½¿ç”¨ã€ç›œè½‰å–” ğŸ™…â€â™€ï¸ è¬è¬ä½ çš„å°Šé‡èˆ‡æº«æŸ” ğŸ’Œ
</p>
</body>
</html>