<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¼æ–‡è©³æƒ… - æ›¦èŠ±æ—YinnTown</title>
      <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9eaff;
      color: #333;
      padding: 30px;
    }
    #postContent {
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.8;
}
    .card {
      max-width: 600px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    h1 {
      color: #bb55cc;
    }
    .meta {
      font-size: 0.9em;
      color: #888;
      margin-bottom: 10px;
    }
i.back-bunny {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  z-index: 9999;
  cursor: pointer;
  display: none; /* âœ… ä¸€é–‹å§‹ä¸é¡¯ç¤º */
  transition: transform 0.3s ease;
}

.back-bunny:hover {
  transform: scale(1.2);
}

.text-pw{
  color: rgb(176, 79, 255);
  transform: translateY(-20px);
}
  </style>
</head>
<body>
      
     <div class="card">
    <h1 id="postTitle">è¼‰å…¥ä¸­...</h1>
    <div class="meta">
      ğŸ‘¤ <span id="postName"></span> | ğŸ•’ <span id="postTime"></span>
    </div>
    <div id="postContent"></div>
    <img id="postImage" style="max-width:100%; border-radius: 8px; margin-top: 15px; display:none">
  </div>
<img src="/favicon.ico" id="backBunny" class="back-bunny" onclick="goBack()" alt="è¿”å›" title="é»æˆ‘è¿”å›">
  <div>â‡§<p class="text-pw">é»æ“Šå…”å…”è¿”å›</p></div>

  <div class="card" style="margin-top: 30px;">
  <h3>ğŸ’¬ ç•™è¨€è©•è«–</h3>
  <textarea id="commentInput" placeholder="è¼¸å…¥ä½ çš„è©•è«–..." rows="3" style="width: 100%; padding: 10px; border-radius: 8px;"></textarea>
  <button onclick="submitComment()" style="margin-top: 10px; padding: 10px 20px; background-color: #bb55cc; color: white; border: none; border-radius: 8px;">é€å‡º</button>
</div>


<div class="card" style="margin-top: 20px;">
  <h3>ğŸ“ æ‰€æœ‰è©•è«–</h3>
  <ul id="commentList" style="padding-left: 20px;"></ul>
</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBkLJKrOdTgk4uf58jpciJIHm9hEYQUFCw",
      authDomain: "yinnlim-mgsg-wall.firebaseapp.com",
      projectId: "yinnlim-mgsg-wall",
      storageBucket: "yinnlim-mgsg-wall.firebasestorage.app",
      messagingSenderId: "811614776183",
      appId: "1:811614776183:web:d0b11607a54b5a4d8a0f72"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const postId = localStorage.getItem("selectedPostId");

    if (postId) {
      db.ref("posts/" + postId).once("value", snapshot => {
        const data = snapshot.val();
        if (data) {
          document.getElementById("postTitle").textContent = data.title;
          document.getElementById("postName").textContent = data.name;
          document.getElementById("postTime").textContent = new Date(data.time).toLocaleString();
          document.getElementById("postContent").textContent = data.content;

          // å¦‚æœæœ‰åœ–ç‰‡
          if (data.imageUrl) {
            const img = document.getElementById("postImage");
            img.src = data.imageUrl;
            img.style.display = "block";
          }
        } else {
          document.getElementById("postTitle").textContent = "æ‰¾ä¸åˆ°é€™ç¯‡è²¼æ–‡ã€‚";
        }
      });
    } else {
      document.getElementById("postTitle").textContent = "æœªæŒ‡å®šè²¼æ–‡ã€‚";
    }
    //=================
    function goBack() {
  const scrollY = localStorage.getItem("scrollY");
  localStorage.removeItem("selectedPostId");

  if (scrollY !== null) {
    localStorage.setItem("restoreScrollY", scrollY); // å†æ¬¡æš«å­˜è®“å›å»å¾Œè®€å–
  }

  if (document.referrer) {
    window.location.href = document.referrer;
  } else {
    window.history.back();
  }
}
//è©•è«–
// å„²å­˜è©•è«–
// ç•™è¨€é€å‡ºï¼ˆéœ€ç™»å…¥ï¼‰
function submitComment() {
  const user = firebase.auth().currentUser;
  const input = document.getElementById("commentInput");
  const text = input.value.trim();

  if (!user) {
    alert("âš ï¸ è«‹å…ˆç™»å…¥æ‰èƒ½ç•™è¨€ï¼");
    return;
  }

  if (!text) return alert("è«‹è¼¸å…¥è©•è«–å…§å®¹");

  const comment = {
    text: text,
    uid: user.uid,
    name: user.displayName || "åŒ¿åç”¨æˆ¶",
    time: Date.now()
  };

  db.ref("comments/" + postId).push(comment).then(() => {
    input.value = "";
    loadComments();
  });
}

// è¼‰å…¥ç•™è¨€
function loadComments() {
  const list = document.getElementById("commentList");
  list.innerHTML = "";

  const user = firebase.auth().currentUser;

  db.ref("comments/" + postId).once("value", snapshot => {
    snapshot.forEach(child => {
      const data = child.val();
      const key = child.key;

      const li = document.createElement("li");
      li.style.marginBottom = "8px";
      li.innerHTML = `ğŸ—¨ï¸ <strong>${data.name}</strong>ï¼š${data.text}<br><small>${new Date(data.time).toLocaleString()}</small>`;

      if (user && user.uid === data.uid) {
        const btn = document.createElement("button");
        btn.textContent = "åˆªé™¤";
        btn.style.marginLeft = "10px";
        btn.style.color = "crimson";
        btn.style.background = "none";
        btn.style.border = "none";
        btn.style.cursor = "pointer";
        btn.onclick = () => {
          db.ref("comments/" + postId + "/" + key).remove().then(() => {
            loadComments();
          });
        };
        li.appendChild(btn);
      }

      list.appendChild(li);
    });
  });
}

// ç›£è½ç™»å…¥ç‹€æ…‹è®ŠåŒ–ï¼Œè‡ªå‹•è¼‰å…¥ç•™è¨€
firebase.auth().onAuthStateChanged(user => {
  if (postId) {
    loadComments();
  }
});

// è¼‰å…¥å®Œæˆæ™‚è‡ªå‹•æ’ˆå–
if (postId) {
  loadComments();
}
</script>
</body>
</html>